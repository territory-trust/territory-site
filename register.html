<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Регистрация — Территория доверия и поддержки</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Регистрация</h1>
      <div class="sub">Вы выбрали линию: <span class="line" id="lineLabel">—</span></div>

      <div class="box">
  <label>Ник (как вас показывать в очереди)</label>
  <input
    id="nick"
    placeholder="Например: олег_киев"
    maxlength="24"
  />
</div>

<div class="box">
  <label>Цель (коротко)</label>
  <input
    id="goal"
    placeholder="Например: лекарства, учеба, ремонт"
    maxlength="80"
  />
</div>

<div class="box">
  <label>Номер карты</label>
  <input
    id="card"
    type="text"
    inputmode="numeric"
    autocomplete="cc-number"
    placeholder="0000 0000 0000 0000"
    maxlength="19"
  />
</div>



      <button class="btn-main" id="nextBtn">Далее → к оплате</button>
      <button class="btn-secondary" onclick="history.back()">Назад</button>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  const nick = document.getElementById("nick");
  const goal = document.getElementById("goal");
  const card = document.getElementById("card");
  const nextBtn = document.getElementById("nextBtn");

  // Если кнопка не найдена — значит id в HTML другой
  if (!nextBtn) return;

  // Стартовое состояние
  nextBtn.disabled = true;
  nextBtn.classList.remove("is-active");

  // Форматирование карты: только цифры + пробелы каждые 4
  function formatCard(value) {
    const digits = value.replace(/\D/g, "").slice(0, 16);   // только 16 цифр
    return digits.replace(/(\d{4})(?=\d)/g, "$1 ").trim();  // 4444 4444 ...
  }

  // Проверка формы + подсветка
  function checkForm() {
    const nickOk = nick.value.trim().length > 0;
    const goalOk = goal.value.trim().length > 0;

    const digits = card.value.replace(/\D/g, "");
    const cardOk = digits.length === 16;

    const ok = nickOk && goalOk && cardOk;

    nextBtn.disabled = !ok;
    nextBtn.classList.toggle("is-active", ok);
  }

  // Ввод карты: форматируем и сохраняем позицию курсора более-менее адекватно
  card.addEventListener("input", () => {
    const before = card.value;
    const beforePos = card.selectionStart;

    card.value = formatCard(card.value);

    // лёгкая попытка не бесить курсором
    const diff = card.value.length - before.length;
    const newPos = Math.max(0, (beforePos ?? card.value.length) + diff);
    card.setSelectionRange(newPos, newPos);

    checkForm();
  });

  nick.addEventListener("input", checkForm);
  goal.addEventListener("input", checkForm);

  // Клик "Далее"
  nextBtn.addEventListener("click", () => {
    const digits = card.value.replace(/\D/g, "");
    if (digits.length !== 16) return;

    localStorage.setItem("nick", nick.value.trim());
    localStorage.setItem("goal", goal.value.trim());
    localStorage.setItem("card", digits);

    // line может быть в url или в localStorage
    const params = new URLSearchParams(window.location.search);
    const line = params.get("line") || localStorage.getItem("line") || "";

    window.location.href = "pay.html?line=" + encodeURIComponent(line);
  });

  // Стартовая проверка
  checkForm();
});
</script>
    

</body>
</html>


