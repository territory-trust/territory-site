<!DOCTYPE html>
<html lang="ru">
<head>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Оплата — Территория доверия и поддержки</title>

  <link rel="stylesheet" href="styles.css">

</head>
<body>

  <div class="wrap pay">
<div class="card">
      <h1>Оплата помощи</h1>
      <div class="sub">
        Линия: <span class="pill" id="linePill">—</span>
        &nbsp;|&nbsp; Сумма к отправке: <b id="sumText">—</b>
      </div>

      <!-- Получатель №1 -->
      <div class="box">
        <div class="row topRow">
  <div class="kv">
    <div class="k">Получатель (№1 в очереди)</div>
    <div class="v" id="toNick"></div>
  </div>

  <div class="kv cardTop">
    <div class="k">Номер карты</div>

    <div class="card-row">
      <div class="v" id="toCard"></div>

      <button id="copyCardBtn" type="button" class="copy-mini" title="Скопировать номер карты">COPY</button>
    </div>

    <div class="copy-msg" id="copyMsg"></div>
  </div>
</div>    
        
<!-- инструкция -->
<div class="box">
  <div class="note">
    <div class="noteTitle">Инструкция по оплате:</div>
    <ol class="steps">
      <li>Переведите сумму на карту участника №1,
используя приложение вашего банка.</li>
      <li>В назначении платежа укажите: <b>«Помощь»</b>.</li>
      <li>После оплаты прикрепите скриншот квитанции для подтверждения.</li>
    </ol>
  </div>
</div>

        
      </div>

      <!-- Скрин -->
<div class="box">

  <label class="file-btn" for="receiptFile">📎 Прикрепить квитанцию</label>
  <input type="file" id="receiptFile" accept="image/*" hidden>

  <div id="fileName" class="file-name"></div>
</div>

<!-- Ярлык -->
<div class="box">
  <div class="checkRow">
    <input id="shortcutChk" type="checkbox">
    <label for="shortcutChk">Создать ярлык на рабочий стол</label>
  </div>
</div>

      <!-- Уведомления -->
      <div class="box">
  <div class="checkRow" id="notifyRow">
    <input id="notifyChk" type="checkbox" />
    <div>🔔 Включить уведомления о подтверждении помощи и движении очереди</div>
  </div>
</div>

      </div>

      <!-- Действия -->
      <button class="btn-main" id="btnNext" disabled>Далее</button>
      <button class="btn-secondary" onclick="history.back()">Назад</button>

      <div class="note" id="resultMsg" style="margin-top:10px;"></div>
    </div>
  </div>
<!-- ====== Модалка предупреждения ====== -->
<div id="confirmModal" class="modal" aria-hidden="true">
  <div class="modal__box">
    <div class="modal__title">Внимание</div>
    <div class="modal__text">
      Вы уверены, что прикрепили копию квитанции?
      <br><br>
      В случае нарушения — блокировка.
    </div>

    
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  // ====== COPY карты ======
  const copyBtn = document.getElementById("copyCardBtn");
  const card = document.getElementById("toCard");

  if (copyBtn && card) {
    copyBtn.addEventListener("click", async () => {
      const text = card.textContent.replace(/\s+/g, " ").trim();
      try {
        await navigator.clipboard.writeText(text);
        const old = copyBtn.textContent;
        copyBtn.textContent = "OK";
        setTimeout(() => copyBtn.textContent = old, 900);
      } catch (e) {
        alert("Не удалось скопировать. Скопируй вручную.");
      }
    });
  }

// ===== ЛОГИКА КНОПКИ "ДАЛЕЕ" =====

const btnNext = document.getElementById("btnNext");
const receiptFile = document.getElementById("receiptFile");
const fileNameBox = document.getElementById("fileName");

const notifyChk = document.getElementById("notifyChk");
const notifyRow = document.getElementById("notifyRow");

// 1. Кнопка становится активной ТОЛЬКО после выбора файла
function refreshNextBtn() {
  const hasFile = !!(receiptFile && receiptFile.files && receiptFile.files.length > 0);
  if (btnNext) {
    btnNext.disabled = !hasFile;
    btnNext.classList.toggle("active", hasFile);
  }
}

// 2. Подсветка блока уведомлений
function highlightNotify(on) {
  if (!notifyRow) return;
  notifyRow.classList.toggle("need-attention", on);
  if (on) {
    notifyRow.scrollIntoView({ behavior: "smooth", block: "center" });
  }
}

// 3. Загрузка файла
if (receiptFile) {
  receiptFile.addEventListener("change", () => {
    if (fileNameBox) {
      fileNameBox.textContent = receiptFile.files[0]
        ? receiptFile.files[0].name
        : "";
    }
    refreshNextBtn();
  });
}

// 4. Клик по "Далее"
if (btnNext) {
  btnNext.addEventListener("click", (e) => {
    e.preventDefault();

    // если уведомления не включены — НЕ ПЕРЕХОДИМ
    if (!notifyChk || !notifyChk.checked) {
      highlightNotify(true);
      return;
    }

    // всё ок — переход
    const params = new URLSearchParams(location.search);
    const line =
      params.get("line") || localStorage.getItem("line") || "50";

    localStorage.setItem("line", line);
    location.href = "warning.html?line=" + encodeURIComponent(line);
  });
}

// стартовое состояние
refreshNextBtn();

</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  // 1. Читаем линию из URL или localStorage
  const params = new URLSearchParams(location.search);
  const lineFromUrl = params.get("line");

  if (lineFromUrl) {
    localStorage.setItem("line", lineFromUrl);
  }

  const line = localStorage.getItem("line") || "50";

  // 2. Данные участников по линиям
  const firstByLine = {
    "10":  { nick: "Олена", card: "5375 1234 5678 1234" },
    "50":  { nick: "Вадим", card: "4441 2222 3333 2222" },
    "100": { nick: "Анна",  card: "5375 5555 6666 5555" }
  };

  const first = firstByLine[line] || firstByLine["50"];

  // 3. Подставляем в интерфейс
  document.getElementById("linePill").textContent = line;
  document.getElementById("sumText").textContent = line + " грн";

  document.getElementById("toNick").textContent = first.nick;
  document.getElementById("toCard").textContent = first.card;

});
</script>
</div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const receipt = document.getElementById("receiptFile");
  const notify  = document.getElementById("notifyChk");
  const btn     = document.getElementById("sentBtn");
  btn.addEventListener("click", (e) => {
  e.preventDefault();
  if (btn.disabled) return;

  const line = localStorage.getItem("line") || "50";
  location.href = "warning.html?line=" + encodeURIComponent(line);
});

  const notifyRow = notify.closest(".checkRow");

  // стартовое состояние
  btn.classList.add("waiting");

  // 1. Прикрепили квитанцию
  receipt.addEventListener("change", () => {
    if (receipt.files.length > 0) {
      btn.classList.remove("waiting");
      btn.classList.add("ready");
      btn.disabled = false;
    }
      

  // Клик по "Далее" -> всегда открываем модалку (когда кнопка уже активна)
  if (btn) {
    btn.addEventListener("click", (e) => {
      // если кнопка вдруг disabled — ничего не делаем
      if (btn.disabled) return;

      e.preventDefault();
      if (confirm("Вы уверены, что прикрепили копию квитанции?\n\nВ случае нарушения — блокировка.")) {
  window.location.href = "cabinet.html";
}
    });
  }

 
 
  });

  // ====== Модалка жёсткого предупреждения ======
const modal = document.getElementById("confirmModal");
const modalYes = document.getElementById("modalYes");
const modalNo  = document.getElementById("modalNo");

  });

  // 3. Включили уведомления → кнопка активна
  notify.addEventListener("change", () => {
    if (notify.checked && receipt.files.length > 0) {
      btn.classList.remove("ready");
      btn.classList.add("active");
      btn.disabled = false;
    }
  });

});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("btnNext");
  if (!btn) return;

  btn.addEventListener("click", (e) => {
    e.preventDefault();

    const line = localStorage.getItem("line") || "50";

    window.location.href =
      "warning.html?line=" + encodeURIComponent(line);
  });
});
</script>

</body>
</html>


















