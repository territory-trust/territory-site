   <!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–ø–ª–∞—Ç–∞ ‚Äî –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è –¥–æ–≤–µ—Ä–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</title>
  <link rel="stylesheet" href="styles.css">

  <!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è pay.html -->
  <style>
    /* –ß—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ –∏ —Ä–æ–≤–Ω–µ–µ —Å–µ—Ç–∫–∞ –¥–ª—è –º–æ–±–∏–ª–∫–∏ */
    .wrap.pay .card { padding-bottom: 18px; }
    .wrap.pay .sub { margin-top: 6px; opacity: .92; line-height: 1.35; }
    .wrap.pay .box { margin-top: 12px; }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –º–µ—Ç–∫–∏ */
    .wrap.pay h1 { margin-bottom: 10px; }
    .pill { display:inline-flex; align-items:center; justify-content:center; min-width: 48px; }

    /* –ü–æ–ª—É—á–∞—Ç–µ–ª—å / –∫–∞—Ä—Ç–∞: –¥–µ–ª–∞–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π –±–ª–æ–∫ */
    .topRow { display:flex; gap:14px; align-items:stretch; flex-wrap: wrap; }
    .kv { flex: 1 1 220px; }
    .kv .k { opacity:.78; font-size: 14px; margin-bottom: 6px; }
    .kv .v { font-weight: 800; font-size: 18px; }

    /* –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π –∏ —É–¥–æ–±–Ω—ã–π */
    .cardTop .v#toCard{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: .6px;
      font-weight: 900;
      font-size: 18px;
      opacity: .98;
      white-space: nowrap;
    }

    .card-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    /* COPY –∫–Ω–æ–ø–∫–∞ ‚Äî –º–∞–ª–µ–Ω—å–∫–∞—è, –Ω–æ —Å—Ç–∏–ª—å–Ω–∞—è, –Ω–µ –≤—ã–±–∏–≤–∞–µ—Ç—Å—è */
    .copy-mini{
      border: 1px solid rgba(255,210,90,.45);
      background: rgba(10, 80, 150, .25);
      color: rgba(255,210,90,.95);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing: .3px;
      min-width: 92px;
      text-align:center;
      box-shadow: 0 0 0 2px rgba(255,210,90,.12) inset;
    }
    .copy-mini:active{ transform: translateY(1px) scale(.99); filter: brightness(.98); }
    .copy-mini .ico{ margin-right: 6px; }

    .copy-msg{
      margin-top: 6px;
      font-size: 13px;
      opacity: .8;
      min-height: 16px;
    }

    /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: —á—É—Ç—å —á–∏—Ç–∞–±–µ–ª—å–Ω–µ–µ */
    .noteTitle{ font-weight: 900; margin-bottom: 8px; font-size: 16px; }
    .steps{ margin: 0; padding-left: 18px; }
    .steps li{ margin: 8px 0; line-height: 1.45; }

    /* –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é: –∏–º—è —Ñ–∞–π–ª–∞ –∫–∞–∫ –±–µ–π–¥–∂ */
    .file-name{
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 700;
      opacity: .95;
    }
    .file-name:empty{ display:none; }
    .file-name::before{
      content: "üìÑ";
      opacity: .9;
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –¥–µ–ª–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–æ–π */
    .checkRow{
      display:flex;
      align-items:flex-start;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    #notifyChk{
      width: 22px;
      height: 22px;
      margin-top: 2px;
      accent-color: #ffd25a;
    }
    .checkRow.attention{
      border-color: rgba(255,210,90,.55);
      box-shadow: 0 0 0 2px rgba(255,210,90,.18) inset;
      animation: payPulse 1.2s ease-in-out 2;
    }
    @keyframes payPulse{
      0%{ filter: brightness(1); transform: translateY(0); }
      50%{ filter: brightness(1.08); transform: translateY(-1px); }
      100%{ filter: brightness(1); transform: translateY(0); }
    }

    /* –ù–∏–∂–Ω–∏–µ –∫–Ω–æ–ø–∫–∏: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –≤ —Ä—è–¥ */
    .actionsRow{
      display:flex;
      gap: 12px;
      margin-top: 14px;
    }
    .actionsRow button{
      flex: 1 1 0;
      min-height: 54px;
      font-weight: 900;
      letter-spacing: .2px;
    }

    /* –£–±–∏—Ä–∞–µ–º ‚Äú—Ç—É—Å–∫–ª–æ—Å—Ç—å‚Äù –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –î–∞–ª–µ–µ (–Ω–æ –æ–Ω–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ disabled) */
    #sentBtn[disabled]{
      opacity: .78;
      filter: grayscale(.12);
    }

    /* –õ—ë–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è */
    button, .btn-main, .btn-secondary{
      transition: transform .08s ease, filter .12s ease, box-shadow .12s ease, opacity .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button:active, .btn-main:active, .btn-secondary:active{
      transform: translateY(1px) scale(.99);
      filter: brightness(.98);
    }
  </style>
</head>

<body>
  <div class="wrap pay">
    <div class="card">
      <h1>–û–ø–ª–∞—Ç–∞ –ø–æ–º–æ—â–∏</h1>

      <div class="sub">
        –õ–∏–Ω–∏—è: <span class="pill" id="linePill">‚Äî</span>
        &nbsp;|&nbsp; –°—É–º–º–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ: <b id="sumText">‚Äî</b>
      </div>

      <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å ‚Ññ1 -->
      <div class="box">
        <div class="row topRow">
          <div class="kv">
            <div class="k">–ü–æ–ª—É—á–∞—Ç–µ–ª—å (‚Ññ1 –≤ –æ—á–µ—Ä–µ–¥–∏)</div>
            <div class="v" id="toNick">‚Äî</div>
          </div>

          <div class="kv cardTop">
            <div class="k">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>

            <div class="card-row">
              <div class="v" id="toCard">‚Äî</div>
              <button id="copyCardBtn" type="button" class="copy-mini" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã">
                <span class="ico">üìã</span> COPY
              </button>
            </div>

            <div class="copy-msg" id="copyMsg"></div>
          </div>
        </div>
      </div>

      <!-- –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
      <div class="box">
        <div class="note">
          <div class="noteTitle">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–ø–ª–∞—Ç–µ</div>
          <ol class="steps">
            <li>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞ –∫–∞—Ä—Ç—É —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Ññ1 –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –í–∞—à–µ–≥–æ –ë–∞–Ω–∫–∞.</li>
            <li>–í –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ —É–∫–∞–∂–∏—Ç–µ: <b>¬´–ü–æ–º–æ—â—å¬ª</b>.</li>
            <li>–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</li>
          </ol>
        </div>
      </div>

      <!-- –°–∫—Ä–∏–Ω -->
      <div class="box">
        <label class="file-btn" for="receiptFile">üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é</label>
        <input type="file" id="receiptFile" accept="image/*" hidden>
        <div id="fileName" class="file-name"></div>
      </div>

      <!-- –Ø—Ä–ª—ã–∫ -->
      <div class="box">
        <div class="note">
          üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å —è—Ä–ª—ã–∫ –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª —á–µ—Ä–µ–∑ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞
          <br>
          <small>–ú–µ–Ω—é ‚ãÆ ‚Üí ¬´–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω¬ª</small>
        </div>
      </div>

      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
      <div class="box">
        <div class="checkRow" id="notifyRow">
          <input id="notifyChk" type="checkbox" />
          <div>
            <div>üîî –í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ–º–æ—â–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏</div>
          </div>
        </div>
      </div>

      <!-- –î–µ–π—Å—Ç–≤–∏—è -->
      <div class="actionsRow">
        <button class="btn-main" id="sentBtn" disabled>–î–∞–ª–µ–µ</button>
        <button class="btn-secondary" id="backBtn" type="button">–ù–∞–∑–∞–¥</button>
      </div>

      <div class="note" id="resultMsg" style="margin-top:10px;"></div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // =========================
    // KEYS (–∫–∞–∫ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö)
    // =========================
    const KEY_STATE = "cabinet_state";
    const KEY_ACTIVE_LINE = "active_line";
    const KEY_REF_OWNER = "ref_owner";

    const LINES = ["10","50","100"];

    // =========================
    // DOM
    // =========================
    const linePill  = document.getElementById("linePill");
    const sumText   = document.getElementById("sumText");
    const toNick    = document.getElementById("toNick");
    const toCard    = document.getElementById("toCard");
    const copyBtn   = document.getElementById("copyCardBtn");
    const copyMsg   = document.getElementById("copyMsg");

    const receipt   = document.getElementById("receiptFile");
    const fileName  = document.getElementById("fileName");
    const notify    = document.getElementById("notifyChk");
    const notifyRow = document.getElementById("notifyRow");

    const sentBtn   = document.getElementById("sentBtn");
    const backBtn   = document.getElementById("backBtn");
    const resultMsg = document.getElementById("resultMsg");

    if (!linePill || !sumText || !toNick || !toCard || !receipt || !notify || !sentBtn || !backBtn) return;

    function getParams() {
      const p = new URLSearchParams(location.search);
      return {
        line: p.get("line") || "",
        ref:  p.get("ref")  || "" // –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–π (–µ—Å–ª–∏ –ø—Ä–æ—Ç–∞—â–∏–ª–∏)
      };
    }

    function resolveLine() {
      const { line } = getParams();
      if (LINES.includes(line)) return line;

      const saved = localStorage.getItem(KEY_ACTIVE_LINE) || "";
      if (LINES.includes(saved)) return saved;

      return "50";
    }

    // =========================
    // TEST DATA: –ø–æ–ª—É—á–∞—Ç–µ–ª—å ‚Ññ1
    // =========================
    const firstByLine = {
      "10":  { nick: "–û–ª–µ–Ω–∞", card: "5375 1234 5678 1234" },
      "50":  { nick: "–í–∞–¥–∏–º", card: "4441 2222 3333 2222" },
      "100": { nick: "–ê–Ω–Ω–∞",  card: "5375 5555 6666 5555" }
    };

    // =========================
    // State helpers
    // =========================
    function readState() {
      try { return JSON.parse(localStorage.getItem(KEY_STATE) || "{}"); }
      catch { return {}; }
    }
    function writeState(state) {
      localStorage.setItem(KEY_STATE, JSON.stringify(state));
    }
    function ensureDefaults(state) {
      if (!state.lines) state.lines = {};
      LINES.forEach(l => {
        if (!state.lines[l]) state.lines[l] = { status: "none", profile: null, tree: { level1: [], level2: [] } };
        if (!("status" in state.lines[l])) state.lines[l].status = "none";
        if (!("profile" in state.lines[l])) state.lines[l].profile = null;
        if (!state.lines[l].tree) state.lines[l].tree = { level1: [], level2: [] };
      });
      return state;
    }

    // =========================
    // INIT
    // =========================
    const { ref } = getParams();
    if (ref) localStorage.setItem(KEY_REF_OWNER, ref);

    const line = resolveLine();
    localStorage.setItem(KEY_ACTIVE_LINE, line);

    const first = firstByLine[line] || firstByLine["50"];

    linePill.textContent = line;
    sumText.textContent = line + " –≥—Ä–Ω";
    toNick.textContent = first.nick;
    toCard.textContent = first.card;

    // =========================
    // COPY
    // =========================
    if (copyBtn) {
      copyBtn.addEventListener("click", async () => {
        const text = (toCard.textContent || "").replace(/\s+/g, " ").trim();
        try {
          await navigator.clipboard.writeText(text);
          const old = copyBtn.innerHTML;
          copyBtn.innerHTML = "‚úÖ OK";
          if (copyMsg) copyMsg.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ";
          setTimeout(() => {
            copyBtn.innerHTML = old;
            if (copyMsg) copyMsg.textContent = "";
          }, 900);
        } catch {
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é.");
        }
      });
    }

    // =========================
    // BUTTON STATE: —Ñ–∞–π–ª + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    // =========================
    function hasFile() {
      return !!(receipt.files && receipt.files.length > 0);
    }

    function refreshBtn() {
      const ok = hasFile() && notify.checked;
      sentBtn.disabled = !ok;
    }

    refreshBtn();

    receipt.addEventListener("change", () => {
      const f = receipt.files && receipt.files[0] ? receipt.files[0].name : "";
      if (fileName) fileName.textContent = f ? f : "";
      refreshBtn();
    });

    notify.addEventListener("change", () => {
      refreshBtn();
    });

    // =========================
    // NAV
    // =========================
    backBtn.addEventListener("click", () => history.back());

    sentBtn.addEventListener("click", (e) => {
      e.preventDefault();

      if (!notify.checked) {
        if (notifyRow) {
          notifyRow.classList.add("attention");
          notifyRow.scrollIntoView({ behavior: "smooth", block: "center" });
          setTimeout(() => notifyRow.classList.remove("attention"), 2500);
        }
        return;
      }

      if (!hasFile()) return;

      let state = ensureDefaults(readState());
      state.lines[line].status = "candidate_waiting";
      writeState(state);

      location.href = `warning.html?line=${encodeURIComponent(line)}`;
    });
  });
  </script>
</body>
</html>

